@if (event(); as event) {
  @if (!event.id) {
    <h1 class="w-full text-2xl font-bold text-center py-1 bg-gray-950 sticky top-0 z-2">New Event</h1>
  }
  <div detail class="grow-1 flex flex-col"
    [style.--read-edit-input__min-w]="editing() ? '20rem' : null">
    <div detail__header class="flex flex-row justify-between items-center my-2">
      <read-edit-input
        label="Título"
        [editMode]="editing()"
        [value]="event.title"
        (valueChange)="event.title = $event || ''"
      >
        <h1 class="text-2xl font-bold">
          @if (state.token()) {
            <span>[{{ event.id }}] </span>
          }
          {{ event.title }}
        </h1>
      </read-edit-input>
      <button class="text-2xl bg-blue-400 cursor-pointer rounded-full aspect-square w-8" (click)="goBack()">←</button>
    </div>

    <div detail__content class="flex flex-row grow-1 gap-4 flex-wrap">
      <div detail__left class="flex flex-col grow-1 basis-0 shrink-0 gap-4 items-start">
        <read-edit-input 
          label="Descripción"
          type="textarea"
          [editMode]="editing()"
          [value]="event.description"
          (valueChange)="event.description = $event"
        />

        <read-edit-input 
          label="Banner Url"
          type="img"
          [style.--read-edit-input__min-w]="'20rem'"
          [editMode]="editing()"
          [value]="event.bannerUrl"
          (valueChange)="event.bannerUrl = $event"
        >
          <a [href]="event.bannerUrl" target="_blank">
            <img class="max-w-[min(20rem, 50dvh)] rounded-md
              bg-[image:url(https://i.imgur.com/wDi0xHn.jpeg)] aspect-[auto_1/1] bg-center bg-cover"
              alt=" "
              [src]="event.bannerUrl"
            />
          </a>
        </read-edit-input>
      </div>

      <div detail__right class="flex flex-col grow-1 basis-0 shrink-0 gap-4">
        <dance-type-pills [danceTypeIds]="event.danceTypeIds"
          [editMode]="editing()"
          (typeClicked)="editDanceTypes($event)"
        />

        <read-edit-input
          label="Dirección"
          [value]="event.location"
          [editMode]="editing()"
          (valueChange)="event.location = $event || ''"
        >
          <a class="cursor-pointer italic hover:text-blue-400" (click)="openGMapsLink(event.location); $event.stopPropagation()">
            {{event.location}}
          </a>
        </read-edit-input>

        <read-edit-input
          label="Precio"
          prefix="€"
          [value]="event.price"
          [editMode]="editing()"
          (valueChange)="event.price = +($event || 0)"
        >
          @let _value = (event.price && (event.price > 0)) ? ('€' + event.price) : 'Gratis';
          <p>{{_value}}</p>
        </read-edit-input>

        <read-edit-input
          label="Fecha del evento"
          type="datetime"
          [editMode]="editing()"
          [value]="event.eventDate"
          (valueChange)="event.eventDate = $event!"
        />

        <event-type-tags [eventTypeIds]="event.eventTypeIds"
          [editMode]="editing()"
          (tagClicked)="editEventType($event)"
        />
      </div>
    </div>
      
    @if (state.token()) {
      <div class="self-center">
        @if (event.created) {
          <small class="flex"><strong>Created:&nbsp;</strong>{{event.created | date:"dd-MMM-yyyy @ hh:mm" }}</small>
        }
        @if (event.updated) {
          <small class="flex"><strong>Updated:&nbsp;</strong>{{event.updated | date:"dd-MMM-yyyy @ hh:mm" }}</small>
        }
      </div>
    }

    @if (state.token()) {
      <div detail__admin-card-preview class="min-w-80 my-2 flex flex-col bg-green-900 gap-2 rounded-xl h-fit self-center sticky bottom-0">
        <h2 class="flex gap-2 justify-center items-baseline content-center text-md text-center font-bold cursor-pointer" (click)="showAdminCardPreview.set(!showAdminCardPreview())">
          Card preview
          <small class="text-xs rotate-270 transition-transform duration-200"
            [class]="{ '[&]:rotate-90': showAdminCardPreview() }"
            >➤
          </small>
        </h2>
        @if (showAdminCardPreview()) {
          <div animate.enter="animate-bottom-up" animate.leave="animate-top-down">
            <event-card class="*:max-w-80"
              [id]="event.id"
              [title]="event.title"
              [bannerUrl]="event.bannerUrl"
              [description]="event.description"
              [price]="event.price"
              [location]="event.location"
              [danceTypeIds]="event.danceTypeIds"
              [eventTypeIds]="event.eventTypeIds"
              [eventDate]="event.eventDate"
              [updated]="event.updated"
            />
          </div>
        }
        <div class="rounded-sm flex overflow-hidden z-1">
          @if (!editing()) {
            <button class="grow-1 basis-0 bg-blue-900 px-2 py-1 cursor-pointer hover:bg-blue-950 transition-colors"
              (click)="editing.set(!editing())">
              Editar?
            </button>
            <button class="grow-1 basis-0 bg-red-900 px-2 py-1 cursor-pointer hover:bg-neutral-950 transition-colors"
              (click)="deleteEvent()">
              Borrar ⚠️
            </button>
          } @else {
            <button class="grow-1 basis-0 bg-blue-900 px-2 py-1 cursor-pointer hover:bg-blue-950 transition-colors"
              (click)="sendEvent()">
              {{ event.id ? 'Actualizar' : 'Crear' }}
            </button>
            <button class="grow-1 basis-0 bg-gray-900 px-2 py-1 cursor-pointer hover:bg-neutral-950 transition-colors"
              (click)="onCancelEdit()">
              Cancelar
            </button>
          }
        </div>
      </div>
    }
  </div>
}
